## 开发平台设计

### 1. 功能描述
一款网页版的记账app。


主要功能点：

 * 用户管理
 * 添加账单记录
 * 账户管理
 * 账户账单管理

### 2. 模块设计

#### 2.1 用户管理

**动作：**

* 新用户注册
* 用户登录
* 修改密码
* 重置密码

**功能点：**

* 用户管理
* 登录管理，Session/Cookie 采用Token实现，每次采用User+Password登录之后生成一个Token，Client端把这个Token保存在localStorage中，每次API调用都需要携带Token，并且页面重新打开后可以调用CheckTokenValid来检查Token有效性，Token有过期时间。

#### 2.2 添加账单记录

**动作：**

* 添加账单
* 修改账单
* 删除账单
* 账单统计（月账单）


**功能点：**

* 添加账单，日账单，可删除，可修改
* 查询账单，月账单，每个账户账单

#### 2.3 账户管理

支出账户或者收入账户（支付宝，银行卡1，银行卡2）
**动作：**

* 添加账户
* 删除账户
* 查修改账户

**功能点：**




### 3. 接口设计

```javascript
package user {
	/**创建用户
	 * 只能创用户
	 * @param email: 使用邮箱地址做为用户的唯一标识
	 * @param password: 用户密码，采用不可逆加密（若前端不加密则服务端加密）
	 * @return IfSuccess: {code=0, message={userid=USERID}}
	 * @return IfFailed:  {code=ERRCODE, message=ERRMESSAGE}
	 */
	CreateUser(email String, cryptoPassword String) JSON

	/**激活用户
	 * @param activationToken token可以自解析用户标识，用户激活后再次激活将返回已经激活错误码
	 * @return IfSuccess: {code=0}
	 * @return IfFailed:  {code=ERRCODE, message=ERRMESSAGE}
	 */
	ActivateUser(activationToken String) JSON

	/**登录
	 * @param emailOrUserid: 邮箱或者userid
	 * @param cryptoPassword: 密码
	 * @return IfSuccess: {code=0, message={userid:USERUD, usertoken:USERTOKEN}}
	 * @return IfFailed:  {code=ERRCODE, message=ERRMESSAGE}
	 */
	Login(emailOrUserid,cryptoPassword String) JSON

	/**检测Token有效性
	 * @param userid
	 * @param usertoken
	 * @return IfSuccess: {code=0}
	 * @return IfFailed:  {code=ERRCODE, message=ERRMESSAGE}
	 */
	CheckTokenValidation(userid,usertoken String) JSON


	/**修改用户密码
	 * @param userid: userid
	 * @param usertoken: usertoken
	 * @param prevCryptoPassword: 老密码
	 * @param newCryptoPassword: 新密码
	 * @return IfSuccess: {code=0}
	 * @return IfFailed:  {code=ERRCODE, message=ERRMESSAGE}
	 */
	ChangePassword(userid,usertoken,prevCryptoPassword,newCryptoPassword String) JSON

	/**重置用户密码
	 * param emailOrUserid: 邮箱或者userid
	 * @return IfSuccess: {code=0, message={userid=USERID}}
	 * @return IfFailed:  {code=ERRCODE, message=ERRMESSAGE}
	 */
	ResetPassword(emailOrUserid) JSON
}

package account {
	/**创建账户
	 * 只能创账户
	 * @param countName: 账户名称
	 * @param initialAmount: 账户初始值
	 * @param accountType: 账户类型（支付宝，银行卡等）
	 * @return IfSuccess: {code=0, message={userid=USERID}}
	 * @return IfFailed:  {code=ERRCODE, message=ERRMESSAGE}
	 */
	CreateAccount(countName String, initialAmount Number, accountType String) JSON

  /**修改账户
   * 只能创用户
   * @param countName: 账户名称
   * @param initialAmount: 账户初始值
   * @param accountType: 账户类型（支付宝，银行卡等）
   * @return IfSuccess: {code=0, message={userid=USERID}}
   * @return IfFailed:  {code=ERRCODE, message=ERRMESSAGE}
   */
  ModifyAccount(countName String, initialAmount Number, accountType String) JSON

  /**删除账户
   * 只能创用户
   * @param countName: 账户名称
   * @return IfSuccess: {code=0, message={userid=USERID}}
   * @return IfFailed:  {code=ERRCODE, message=ERRMESSAGE}
   */
  ModifyAccount(countName String) JSON


  /**查询账户信息
   * 只能创用户
   * @param countName: 账户名称
   * @return IfSuccess: {code=0, message={userid=USERID}}
   * @return IfFailed:  {code=ERRCODE, message=ERRMESSAGE}
   */
  ModifyAccount(countName String) JSON
}




```

### 4. 模型设计

```go
ErrCodes = {
	UserHasExist,
	UserHasActivated,
	UserNotExist,
	UserNotActivated,
	PasswordMismatch,
	PasswordInvalid,
	AppHasVerified,
	AppConfigInvalid,
}

UserRoles = {
	admin = "admin"
	common = "common"
}

AppStates = {
	primal = "primal",
	verifying = "verifying",
	verified = "verified",
	locked = "locked"
}

package user {
	user_info = {
		userid string PRIMARY KEY AUTOMATIC,
		email string UNIQUE,
		password string,
		role UserRoles_enum,
		privileges string,
		phone string,
		company string,
		usertoken string，
		createTime timestamp,
		expireTime timestamp,
		active int
	}
}

package app {
	app_info = {
		appid string PRIMARY KEY AUTOMATIC,
		appName string,
		appAbbr string,
		appIntro string,
		appRegions string, // Format: "CN;AME;EUR;ALL"
		appPrivileges string, // Format:"Snap;Auth2;" ;不是分隔符
		avatar string,
		company string,
		companyAbbr string,
		createTime timestamp,
		modifyTime timestamp,
		contact string,
		description string,
		appkey string,
		apptoken string,
		userid string FOREIGN,
		appState AppStates_enum
	},

	app_message = {
		messageid PRIMARY KEY AUTOMATIC,
		receiver string, // 消息接收者
		userid string, // 消息内容相关的userid
		appid string, // 消息内容相关的appid
		category string,
		content string,
		createTime timestamp,
		readTime timestamp
	}
}

```
